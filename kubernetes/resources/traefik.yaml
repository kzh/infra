apiVersion: traefik.containo.us/v1alpha1
kind: TLSOption
metadata:
  name: internal-mtls
  namespace: kube-system
spec:
  clientAuth:
    secretNames:
    - internal-ca
    clientAuthType: RequireAndVerifyClientCert
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: traefik-dashboard
  namespace: kube-system
spec:
  entryPoints:
  - websecure
  routes:
  - kind: Rule
    match: Host(`traefik.faust.dev`)
    services:
    - kind: TraefikService
      name: dashboard@internal
  - kind: Rule
    match: Host(`traefik.faust.dev`) && PathPrefix(`/api`)
    services:
    - kind: TraefikService
      name: api@internal
  tls:
    secretName: internal-crt
    options:
      name: internal-mtls
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: prometheus-operator
  namespace: monitoring
spec:
  entryPoints:
  - websecure
  routes:
  - kind: Rule
    match: Host(`grafana.faust.dev`)
    services:
    - kind: Service
      name: prometheus-operator-grafana
      port: 80
  - kind: Rule
    match: Host(`prometheus.faust.dev`)
    services:
    - kind: Service
      name: prometheus-operator-prometheus
      port: 9090
  tls:
    secretName: internal-crt
    options:
      name: internal-mtls
      namespace: kube-system
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: elastic
  namespace: observability
spec:
  entryPoints:
  - websecure
  routes:
  - kind: Rule
    match: Host(`kibana.faust.dev`)
    services:
    - kind: Service
      name: kibana-kibana
      port: 5601
  tls:
    secretName: internal-crt
    options:
      name: internal-mtls
      namespace: kube-system
